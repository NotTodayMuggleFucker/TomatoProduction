{"ast":null,"code":"import _extends from 'babel-runtime/helpers/extends';\nimport _objectWithoutProperties from 'babel-runtime/helpers/objectWithoutProperties';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _createClass from 'babel-runtime/helpers/createClass';\nimport _inherits from 'babel-runtime/helpers/inherits';\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport ReactDOM from 'react-dom';\nimport { polyfill } from 'react-lifecycles-compat';\nimport TweenOne, { ticker } from 'rc-tween-one';\nimport easeTween from 'tween-functions';\nimport { getGsapType, isConvert, stylesToCss, checkStyleName } from 'style-utils';\nimport BgElement from './BgElement';\nimport { currentScrollTop, currentScrollLeft, dataToArray, toArrayChildren, setAnimCompToTagComp } from './utils';\nimport animType from './anim';\n\nfunction noop() {}\n\nvar Element = function (_Component) {\n  _inherits(Element, _Component);\n\n  _createClass(Element, null, [{\n    key: 'getDerivedStateFromProps',\n    value: function getDerivedStateFromProps(props, _ref) {\n      var prevProps = _ref.prevProps,\n          $self = _ref.$self,\n          show = _ref.show,\n          mouseMoveType = _ref.mouseMoveType;\n      var nextState = {\n        prevProps: props\n      };\n\n      if (prevProps && props !== prevProps) {\n        if ($self.tickerId !== -1) {\n          ticker.clear($self.tickerId);\n          $self.tickerId = -1;\n        }\n\n        var followParallax = props.followParallax;\n\n        if ($self.followParallax && !followParallax) {\n          $self.reFollowParallax();\n        } else {\n          $self.followParallax = followParallax;\n        }\n\n        if (show || props.show || mouseMoveType) {\n          nextState.mouseMoveType = props.mouseMoveType;\n        }\n      }\n\n      return nextState;\n    }\n  }]);\n\n  function Element(props) {\n    _classCallCheck(this, Element);\n\n    var _this = _possibleConstructorReturn(this, (Element.__proto__ || Object.getPrototypeOf(Element)).call(this, props));\n\n    _initialiseProps.call(_this);\n\n    _this.state = {\n      show: props.show,\n      $self: _this\n    };\n    _this.tickerId = -1;\n    _this.enterMouse = null;\n    _this.delayTimeout = null;\n    _this.followParallax = props.followParallax;\n    _this.transform = checkStyleName('transform');\n    return _this;\n  }\n\n  _createClass(Element, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      this.dom = ReactDOM.findDOMNode(this);\n    }\n  }, {\n    key: 'componentDidUpdate',\n    value: function componentDidUpdate() {\n      if (this.followParallax) {\n        this.doms = this.followParallax.data.map(function (item) {\n          return document.getElementById(item.id);\n        });\n      }\n    }\n  }, {\n    key: 'componentWillUnmount',\n    value: function componentWillUnmount() {\n      ticker.clear(this.timeoutID);\n      ticker.clear(this.delayTimeout);\n      this.delayTimeout = -1;\n      this.timeoutID = -1;\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _props = this.props,\n          prefixCls = _props.prefixCls,\n          callBack = _props.callBack,\n          propsAnimType = _props.animType,\n          duration = _props.duration,\n          delay = _props.delay,\n          ease = _props.ease,\n          elemOffset = _props.elemOffset,\n          followParallax = _props.followParallax,\n          show = _props.show,\n          type = _props.type,\n          direction = _props.direction,\n          leaveChildHide = _props.leaveChildHide,\n          sync = _props.sync,\n          ratio = _props.ratio,\n          mouseMoveType = _props.mouseMoveType,\n          children = _props.children,\n          propsStyle = _props.style,\n          componentProps = _props.componentProps,\n          props = _objectWithoutProperties(_props, ['prefixCls', 'callBack', 'animType', 'duration', 'delay', 'ease', 'elemOffset', 'followParallax', 'show', 'type', 'direction', 'leaveChildHide', 'sync', 'ratio', 'mouseMoveType', 'children', 'style', 'componentProps']);\n\n      var _state = this.state,\n          currentShow = _state.show,\n          currentMouseMoveType = _state.mouseMoveType;\n\n      var style = _extends({}, propsStyle);\n\n      style.display = show ? 'block' : 'none';\n      style.position = 'absolute';\n      style.width = '100%';\n\n      if (mouseMoveType !== 'end') {\n        style[this.transform] = '';\n      }\n\n      props.style = style;\n      props.className = ('banner-anim-elem ' + (prefixCls || '')).trim();\n      var bgElem = toArrayChildren(children).filter(function (item) {\n        return item && item.type.isBannerAnimBgElement;\n      }).map(function (item) {\n        return React.cloneElement(item, {\n          show: props.show\n        });\n      });\n\n      if (currentShow === show && !currentMouseMoveType || currentMouseMoveType === 'reChild') {\n        props.animation = {\n          x: 0,\n          y: 0,\n          type: 'set'\n        };\n\n        if (!show) {\n          this.enterMouse = null;\n          return React.createElement(TweenOne, props, bgElem);\n        }\n\n        if (followParallax) {\n          props.onMouseMove = this.getFollowMouseMove();\n        }\n\n        return React.createElement(TweenOne, props, mouseMoveType === 'update' ? bgElem : this.getChildren());\n      }\n\n      var $props = _extends({}, props, componentProps);\n\n      return this.animChildren($props, style, bgElem);\n    }\n  }]);\n\n  return Element;\n}(Component);\n\nvar _initialiseProps = function _initialiseProps() {\n  var _this2 = this;\n\n  this.onMouseMove = function (e) {\n    _this2.domRect = _this2.dom.getBoundingClientRect();\n    _this2.enterMouse = _this2.enterMouse || {\n      x: _this2.domRect.width / 2,\n      y: _this2.domRect.height / 2\n    };\n    _this2.domWH = {\n      w: _this2.domRect.width,\n      h: _this2.domRect.height\n    };\n    _this2.offsetTop = _this2.domRect.top + currentScrollTop();\n    _this2.offsetLeft = _this2.domRect.left + currentScrollLeft();\n    var mouseXY = {\n      x: e.pageX - _this2.offsetLeft,\n      y: e.pageY - _this2.offsetTop\n    };\n\n    _this2.setTicker(_this2.followParallax, mouseXY);\n  };\n\n  this.setTicker = function (followParallax, mouseXY) {\n    var callback = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : noop;\n    ticker.clear(_this2.tickerId);\n    _this2.tickerId = 'bannerElementTicker' + (Date.now() + Math.random());\n    var startFrame = ticker.frame;\n    var startX = _this2.enterMouse.x;\n    var startY = _this2.enterMouse.y;\n    var duration = followParallax.duration || 450;\n    var easeFunc = easeTween[followParallax.ease || 'easeOutQuad'];\n    var start = typeof followParallax.minMove === 'number' ? followParallax.minMove : 0.08;\n    ticker.wake(_this2.tickerId, function () {\n      var moment = (ticker.frame - startFrame) * ticker.perFrame;\n      var ratio = easeFunc(moment, start, 1, duration);\n      _this2.enterMouse.x = startX + (mouseXY.x - startX) * ratio;\n      _this2.enterMouse.y = startY + (mouseXY.y - startY) * ratio;\n\n      _this2.setFollowStyle(_this2.domWH);\n\n      if (moment >= duration) {\n        ticker.clear(_this2.tickerId);\n        callback();\n      }\n    });\n  };\n\n  this.getFollowMouseMove = function () {\n    var onMouseMove = void 0;\n\n    if (_this2.followParallax) {\n      if (_this2.followParallax.delay) {\n        onMouseMove = !_this2.delayTimeout ? null : _this2.state.onMouseMove;\n        _this2.delayTimeout = _this2.delayTimeout || ticker.timeout(function () {\n          _this2.setState({\n            onMouseMove: _this2.onMouseMove\n          });\n        }, _this2.followParallax.delay);\n      } else {\n        onMouseMove = _this2.onMouseMove;\n      }\n    }\n\n    return onMouseMove;\n  };\n\n  this.getFollowStyle = function (data, domWH) {\n    var style = {};\n    dataToArray(data.type).forEach(function (type) {\n      var mouseData = _this2.enterMouse.x;\n      var domData = domWH.w;\n      var value = data.value;\n\n      if ((type.indexOf('y') >= 0 || type.indexOf('Y') >= 0) && type !== 'opacity') {\n        mouseData = _this2.enterMouse.y;\n        domData = domWH.h;\n      }\n\n      var d = (mouseData - domData / 2) / (domData / 2) * value;\n\n      var _type = getGsapType(type);\n\n      var cssName = isConvert(_type);\n\n      if (cssName === 'transform') {\n        var transform = checkStyleName('transform');\n        style[transform] = style[transform] || {};\n        style[transform][_type] = stylesToCss(_type, d).trim();\n      } else if (cssName === 'filter') {\n        var filter = checkStyleName('filter');\n        style[filter] = style[filter] || {};\n        style[filter][_type] = stylesToCss(_type, d).trim();\n      } else {\n        style[cssName] = stylesToCss(_type, d).trim();\n      }\n    });\n    return style;\n  };\n\n  this.setFollowStyle = function (domWH) {\n    _this2.doms.forEach(function (item, i) {\n      if (!item) {\n        return;\n      }\n\n      var data = _this2.followParallax.data[i];\n\n      var style = _this2.getFollowStyle(data, domWH);\n\n      Object.keys(style).forEach(function (key) {\n        if (typeof style[key] === 'object') {\n          var styleStr = '';\n          Object.keys(style[key]).forEach(function (_key) {\n            styleStr += (' ' + _key + '(' + style[key][_key] + ')').trim();\n          });\n          item.style[key] = styleStr;\n          return;\n        }\n\n        item.style[key] = key.indexOf('backgroundPosition') >= 0 ? 'calc(' + (data.bgPosition || '0%') + ' + ' + style[key] + ' )' : style[key];\n      });\n    });\n  };\n\n  this.getChildren = function () {\n    return toArrayChildren(_this2.props.children).map(function (item, i) {\n      if (item && item.type === BgElement) {\n        return React.cloneElement(item, {\n          show: _this2.state.show\n        });\n      }\n\n      return _this2.useTagComp ? setAnimCompToTagComp(item, i) : item;\n    });\n  };\n\n  this.reFollowParallax = function () {\n    if (!_this2.domRect) {\n      return;\n    }\n\n    _this2.setTicker(_this2.followParallax, {\n      x: _this2.domRect.width / 2 - _this2.offsetLeft,\n      y: _this2.domRect.height / 2 - _this2.offsetTop\n    }, function () {\n      _this2.followParallax = null;\n    });\n  };\n\n  this.animEnd = function () {\n    var type = _this2.state.show ? 'enter' : 'leave';\n\n    _this2.props.callBack(type);\n\n    _this2.setState(function (_, props) {\n      return {\n        show: props.show,\n        mouseMoveType: null\n      };\n    });\n  };\n\n  this.animChildren = function (props, style, bgElem) {\n    var _props2 = _this2.props,\n        elemOffset = _props2.elemOffset,\n        leaveChildHide = _props2.leaveChildHide,\n        ratio = _props2.ratio,\n        currentAnimType = _props2.animType,\n        direction = _props2.direction,\n        mouseMoveType = _props2.mouseMoveType,\n        ease = _props2.ease,\n        duration = _props2.duration,\n        delay = _props2.delay,\n        show = _props2.show,\n        sync = _props2.sync,\n        component = _props2.component;\n\n    if (_this2.tickerId) {\n      ticker.clear(_this2.tickerId);\n    }\n\n    if (_this2.delayTimeout) {\n      ticker.clear(_this2.delayTimeout);\n      _this2.delayTimeout = null;\n    }\n\n    style.display = 'block';\n    props.component = component;\n    style.zIndex = show ? 1 : 0;\n    var type = show ? 'enter' : 'leave';\n    _this2.useTagComp = (currentAnimType === animType.gridBar || currentAnimType === animType.grid) && (show === _this2.state.show || _this2.state.show && !show); // 状态没改，锁定 children \n\n    props.children = !sync && (show && show !== _this2.state.show || !show && !_this2.state.show) ? bgElem : _this2.getChildren();\n    var childrenToRender = React.createElement(TweenOne, props);\n    var $ratio = mouseMoveType === 'end' && ratio <= 0.3 ? 1 - ratio : ratio;\n    var tag = currentAnimType(childrenToRender, type, direction, {\n      ease: ease,\n      duration: duration,\n      delay: delay,\n      onComplete: _this2.animEnd\n    }, elemOffset, leaveChildHide, $ratio, _this2.state.mouseMoveType === 'update');\n\n    var tagProps = _objectWithoutProperties(tag.props, []);\n\n    if (tagProps.animation) {\n      tagProps.moment = (tagProps.animation.duration + tagProps.animation.delay) * $ratio || 0;\n      tagProps.paused = _this2.state.mouseMoveType === 'update' || $ratio === 1;\n    }\n\n    return React.cloneElement(tag, tagProps);\n  };\n};\n\nElement.propTypes = {\n  children: PropTypes.any,\n  style: PropTypes.object,\n  prefixCls: PropTypes.string,\n  component: PropTypes.any,\n  elemOffset: PropTypes.object,\n  type: PropTypes.string,\n  animType: PropTypes.func,\n  ease: PropTypes.string,\n  duration: PropTypes.number,\n  delay: PropTypes.number,\n  direction: PropTypes.string,\n  callBack: PropTypes.func,\n  followParallax: PropTypes.any,\n  show: PropTypes.bool,\n  leaveChildHide: PropTypes.bool,\n  sync: PropTypes.bool,\n  ratio: PropTypes.number,\n  mouseMoveType: PropTypes.string,\n  componentProps: PropTypes.object\n};\nElement.defaultProps = {\n  component: 'div',\n  componentProps: {},\n  callBack: noop,\n  delay: 0\n};\nElement.BgElement = polyfill(BgElement);\nElement.isBannerAnimElement = true;\nexport default polyfill(Element);","map":{"version":3,"sources":["/Users/david/Catapulta/Documents/PotatoProduction/AntDesignTheme/node_modules/rc-banner-anim/es/Element.js"],"names":["_extends","_objectWithoutProperties","_classCallCheck","_possibleConstructorReturn","_createClass","_inherits","React","Component","PropTypes","ReactDOM","polyfill","TweenOne","ticker","easeTween","getGsapType","isConvert","stylesToCss","checkStyleName","BgElement","currentScrollTop","currentScrollLeft","dataToArray","toArrayChildren","setAnimCompToTagComp","animType","noop","Element","_Component","key","value","getDerivedStateFromProps","props","_ref","prevProps","$self","show","mouseMoveType","nextState","tickerId","clear","followParallax","reFollowParallax","_this","__proto__","Object","getPrototypeOf","call","_initialiseProps","state","enterMouse","delayTimeout","transform","componentDidMount","dom","findDOMNode","componentDidUpdate","doms","data","map","item","document","getElementById","id","componentWillUnmount","timeoutID","render","_props","prefixCls","callBack","propsAnimType","duration","delay","ease","elemOffset","type","direction","leaveChildHide","sync","ratio","children","propsStyle","style","componentProps","_state","currentShow","currentMouseMoveType","display","position","width","className","trim","bgElem","filter","isBannerAnimBgElement","cloneElement","animation","x","y","createElement","onMouseMove","getFollowMouseMove","getChildren","$props","animChildren","_this2","e","domRect","getBoundingClientRect","height","domWH","w","h","offsetTop","top","offsetLeft","left","mouseXY","pageX","pageY","setTicker","callback","arguments","length","undefined","Date","now","Math","random","startFrame","frame","startX","startY","easeFunc","start","minMove","wake","moment","perFrame","setFollowStyle","timeout","setState","getFollowStyle","forEach","mouseData","domData","indexOf","d","_type","cssName","i","keys","styleStr","_key","bgPosition","useTagComp","animEnd","_","_props2","currentAnimType","component","zIndex","gridBar","grid","childrenToRender","$ratio","tag","onComplete","tagProps","paused","propTypes","any","object","string","func","number","bool","defaultProps","isBannerAnimElement"],"mappings":"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","sourcesContent":["import _extends from 'babel-runtime/helpers/extends';\nimport _objectWithoutProperties from 'babel-runtime/helpers/objectWithoutProperties';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _createClass from 'babel-runtime/helpers/createClass';\nimport _inherits from 'babel-runtime/helpers/inherits';\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport ReactDOM from 'react-dom';\nimport { polyfill } from 'react-lifecycles-compat';\nimport TweenOne, { ticker } from 'rc-tween-one';\nimport easeTween from 'tween-functions';\nimport { getGsapType, isConvert, stylesToCss, checkStyleName } from 'style-utils';\n\nimport BgElement from './BgElement';\nimport { currentScrollTop, currentScrollLeft, dataToArray, toArrayChildren, setAnimCompToTagComp } from './utils';\nimport animType from './anim';\n\nfunction noop() {}\n\nvar Element = function (_Component) {\n  _inherits(Element, _Component);\n\n  _createClass(Element, null, [{\n    key: 'getDerivedStateFromProps',\n    value: function getDerivedStateFromProps(props, _ref) {\n      var prevProps = _ref.prevProps,\n          $self = _ref.$self,\n          show = _ref.show,\n          mouseMoveType = _ref.mouseMoveType;\n\n      var nextState = {\n        prevProps: props\n      };\n      if (prevProps && props !== prevProps) {\n        if ($self.tickerId !== -1) {\n          ticker.clear($self.tickerId);\n          $self.tickerId = -1;\n        }\n        var followParallax = props.followParallax;\n        if ($self.followParallax && !followParallax) {\n          $self.reFollowParallax();\n        } else {\n          $self.followParallax = followParallax;\n        }\n        if (show || props.show || mouseMoveType) {\n          nextState.mouseMoveType = props.mouseMoveType;\n        }\n      }\n      return nextState;\n    }\n  }]);\n\n  function Element(props) {\n    _classCallCheck(this, Element);\n\n    var _this = _possibleConstructorReturn(this, (Element.__proto__ || Object.getPrototypeOf(Element)).call(this, props));\n\n    _initialiseProps.call(_this);\n\n    _this.state = {\n      show: props.show,\n      $self: _this\n    };\n    _this.tickerId = -1;\n    _this.enterMouse = null;\n    _this.delayTimeout = null;\n    _this.followParallax = props.followParallax;\n    _this.transform = checkStyleName('transform');\n    return _this;\n  }\n\n  _createClass(Element, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      this.dom = ReactDOM.findDOMNode(this);\n    }\n  }, {\n    key: 'componentDidUpdate',\n    value: function componentDidUpdate() {\n      if (this.followParallax) {\n        this.doms = this.followParallax.data.map(function (item) {\n          return document.getElementById(item.id);\n        });\n      }\n    }\n  }, {\n    key: 'componentWillUnmount',\n    value: function componentWillUnmount() {\n      ticker.clear(this.timeoutID);\n      ticker.clear(this.delayTimeout);\n      this.delayTimeout = -1;\n      this.timeoutID = -1;\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _props = this.props,\n          prefixCls = _props.prefixCls,\n          callBack = _props.callBack,\n          propsAnimType = _props.animType,\n          duration = _props.duration,\n          delay = _props.delay,\n          ease = _props.ease,\n          elemOffset = _props.elemOffset,\n          followParallax = _props.followParallax,\n          show = _props.show,\n          type = _props.type,\n          direction = _props.direction,\n          leaveChildHide = _props.leaveChildHide,\n          sync = _props.sync,\n          ratio = _props.ratio,\n          mouseMoveType = _props.mouseMoveType,\n          children = _props.children,\n          propsStyle = _props.style,\n          componentProps = _props.componentProps,\n          props = _objectWithoutProperties(_props, ['prefixCls', 'callBack', 'animType', 'duration', 'delay', 'ease', 'elemOffset', 'followParallax', 'show', 'type', 'direction', 'leaveChildHide', 'sync', 'ratio', 'mouseMoveType', 'children', 'style', 'componentProps']);\n\n      var _state = this.state,\n          currentShow = _state.show,\n          currentMouseMoveType = _state.mouseMoveType;\n\n      var style = _extends({}, propsStyle);\n      style.display = show ? 'block' : 'none';\n      style.position = 'absolute';\n      style.width = '100%';\n      if (mouseMoveType !== 'end') {\n        style[this.transform] = '';\n      }\n      props.style = style;\n      props.className = ('banner-anim-elem ' + (prefixCls || '')).trim();\n      var bgElem = toArrayChildren(children).filter(function (item) {\n        return item && item.type.isBannerAnimBgElement;\n      }).map(function (item) {\n        return React.cloneElement(item, { show: props.show });\n      });\n      if (currentShow === show && !currentMouseMoveType || currentMouseMoveType === 'reChild') {\n        props.animation = { x: 0, y: 0, type: 'set' };\n        if (!show) {\n          this.enterMouse = null;\n          return React.createElement(TweenOne, props, bgElem);\n        }\n        if (followParallax) {\n          props.onMouseMove = this.getFollowMouseMove();\n        }\n        return React.createElement(TweenOne, props, mouseMoveType === 'update' ? bgElem : this.getChildren());\n      }\n      var $props = _extends({}, props, componentProps);\n      return this.animChildren($props, style, bgElem);\n    }\n  }]);\n\n  return Element;\n}(Component);\n\nvar _initialiseProps = function _initialiseProps() {\n  var _this2 = this;\n\n  this.onMouseMove = function (e) {\n    _this2.domRect = _this2.dom.getBoundingClientRect();\n    _this2.enterMouse = _this2.enterMouse || { x: _this2.domRect.width / 2, y: _this2.domRect.height / 2 };\n    _this2.domWH = {\n      w: _this2.domRect.width,\n      h: _this2.domRect.height\n    };\n    _this2.offsetTop = _this2.domRect.top + currentScrollTop();\n    _this2.offsetLeft = _this2.domRect.left + currentScrollLeft();\n    var mouseXY = {\n      x: e.pageX - _this2.offsetLeft,\n      y: e.pageY - _this2.offsetTop\n    };\n    _this2.setTicker(_this2.followParallax, mouseXY);\n  };\n\n  this.setTicker = function (followParallax, mouseXY) {\n    var callback = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : noop;\n\n    ticker.clear(_this2.tickerId);\n    _this2.tickerId = 'bannerElementTicker' + (Date.now() + Math.random());\n    var startFrame = ticker.frame;\n    var startX = _this2.enterMouse.x;\n    var startY = _this2.enterMouse.y;\n    var duration = followParallax.duration || 450;\n    var easeFunc = easeTween[followParallax.ease || 'easeOutQuad'];\n    var start = typeof followParallax.minMove === 'number' ? followParallax.minMove : 0.08;\n    ticker.wake(_this2.tickerId, function () {\n      var moment = (ticker.frame - startFrame) * ticker.perFrame;\n      var ratio = easeFunc(moment, start, 1, duration);\n      _this2.enterMouse.x = startX + (mouseXY.x - startX) * ratio;\n      _this2.enterMouse.y = startY + (mouseXY.y - startY) * ratio;\n      _this2.setFollowStyle(_this2.domWH);\n      if (moment >= duration) {\n        ticker.clear(_this2.tickerId);\n        callback();\n      }\n    });\n  };\n\n  this.getFollowMouseMove = function () {\n    var onMouseMove = void 0;\n    if (_this2.followParallax) {\n      if (_this2.followParallax.delay) {\n        onMouseMove = !_this2.delayTimeout ? null : _this2.state.onMouseMove;\n        _this2.delayTimeout = _this2.delayTimeout || ticker.timeout(function () {\n          _this2.setState({\n            onMouseMove: _this2.onMouseMove\n          });\n        }, _this2.followParallax.delay);\n      } else {\n        onMouseMove = _this2.onMouseMove;\n      }\n    }\n    return onMouseMove;\n  };\n\n  this.getFollowStyle = function (data, domWH) {\n    var style = {};\n    dataToArray(data.type).forEach(function (type) {\n      var mouseData = _this2.enterMouse.x;\n      var domData = domWH.w;\n      var value = data.value;\n      if ((type.indexOf('y') >= 0 || type.indexOf('Y') >= 0) && type !== 'opacity') {\n        mouseData = _this2.enterMouse.y;\n        domData = domWH.h;\n      }\n      var d = (mouseData - domData / 2) / (domData / 2) * value;\n      var _type = getGsapType(type);\n      var cssName = isConvert(_type);\n      if (cssName === 'transform') {\n        var transform = checkStyleName('transform');\n        style[transform] = style[transform] || {};\n        style[transform][_type] = stylesToCss(_type, d).trim();\n      } else if (cssName === 'filter') {\n        var filter = checkStyleName('filter');\n        style[filter] = style[filter] || {};\n        style[filter][_type] = stylesToCss(_type, d).trim();\n      } else {\n        style[cssName] = stylesToCss(_type, d).trim();\n      }\n    });\n    return style;\n  };\n\n  this.setFollowStyle = function (domWH) {\n    _this2.doms.forEach(function (item, i) {\n      if (!item) {\n        return;\n      }\n      var data = _this2.followParallax.data[i];\n      var style = _this2.getFollowStyle(data, domWH);\n      Object.keys(style).forEach(function (key) {\n        if (typeof style[key] === 'object') {\n          var styleStr = '';\n          Object.keys(style[key]).forEach(function (_key) {\n            styleStr += (' ' + _key + '(' + style[key][_key] + ')').trim();\n          });\n          item.style[key] = styleStr;\n          return;\n        }\n        item.style[key] = key.indexOf('backgroundPosition') >= 0 ? 'calc(' + (data.bgPosition || '0%') + ' + ' + style[key] + ' )' : style[key];\n      });\n    });\n  };\n\n  this.getChildren = function () {\n    return toArrayChildren(_this2.props.children).map(function (item, i) {\n      if (item && item.type === BgElement) {\n        return React.cloneElement(item, { show: _this2.state.show });\n      }\n      return _this2.useTagComp ? setAnimCompToTagComp(item, i) : item;\n    });\n  };\n\n  this.reFollowParallax = function () {\n    if (!_this2.domRect) {\n      return;\n    }\n    _this2.setTicker(_this2.followParallax, {\n      x: _this2.domRect.width / 2 - _this2.offsetLeft,\n      y: _this2.domRect.height / 2 - _this2.offsetTop\n    }, function () {\n      _this2.followParallax = null;\n    });\n  };\n\n  this.animEnd = function () {\n    var type = _this2.state.show ? 'enter' : 'leave';\n    _this2.props.callBack(type);\n    _this2.setState(function (_, props) {\n      return { show: props.show, mouseMoveType: null };\n    });\n  };\n\n  this.animChildren = function (props, style, bgElem) {\n    var _props2 = _this2.props,\n        elemOffset = _props2.elemOffset,\n        leaveChildHide = _props2.leaveChildHide,\n        ratio = _props2.ratio,\n        currentAnimType = _props2.animType,\n        direction = _props2.direction,\n        mouseMoveType = _props2.mouseMoveType,\n        ease = _props2.ease,\n        duration = _props2.duration,\n        delay = _props2.delay,\n        show = _props2.show,\n        sync = _props2.sync,\n        component = _props2.component;\n\n    if (_this2.tickerId) {\n      ticker.clear(_this2.tickerId);\n    }\n    if (_this2.delayTimeout) {\n      ticker.clear(_this2.delayTimeout);\n      _this2.delayTimeout = null;\n    }\n    style.display = 'block';\n\n    props.component = component;\n    style.zIndex = show ? 1 : 0;\n    var type = show ? 'enter' : 'leave';\n    _this2.useTagComp = (currentAnimType === animType.gridBar || currentAnimType === animType.grid) && (show === _this2.state.show || _this2.state.show && !show);\n    // 状态没改，锁定 children \n    props.children = !sync && (show && show !== _this2.state.show || !show && !_this2.state.show) ? bgElem : _this2.getChildren();\n    var childrenToRender = React.createElement(TweenOne, props);\n    var $ratio = mouseMoveType === 'end' && ratio <= 0.3 ? 1 - ratio : ratio;\n    var tag = currentAnimType(childrenToRender, type, direction, {\n      ease: ease,\n      duration: duration,\n      delay: delay,\n      onComplete: _this2.animEnd\n    }, elemOffset, leaveChildHide, $ratio, _this2.state.mouseMoveType === 'update');\n\n    var tagProps = _objectWithoutProperties(tag.props, []);\n\n    if (tagProps.animation) {\n      tagProps.moment = (tagProps.animation.duration + tagProps.animation.delay) * $ratio || 0;\n      tagProps.paused = _this2.state.mouseMoveType === 'update' || $ratio === 1;\n    }\n    return React.cloneElement(tag, tagProps);\n  };\n};\n\nElement.propTypes = {\n  children: PropTypes.any,\n  style: PropTypes.object,\n  prefixCls: PropTypes.string,\n  component: PropTypes.any,\n  elemOffset: PropTypes.object,\n  type: PropTypes.string,\n  animType: PropTypes.func,\n  ease: PropTypes.string,\n  duration: PropTypes.number,\n  delay: PropTypes.number,\n  direction: PropTypes.string,\n  callBack: PropTypes.func,\n  followParallax: PropTypes.any,\n  show: PropTypes.bool,\n  leaveChildHide: PropTypes.bool,\n  sync: PropTypes.bool,\n  ratio: PropTypes.number,\n  mouseMoveType: PropTypes.string,\n  componentProps: PropTypes.object\n};\nElement.defaultProps = {\n  component: 'div',\n  componentProps: {},\n  callBack: noop,\n  delay: 0\n};\n\nElement.BgElement = polyfill(BgElement);\nElement.isBannerAnimElement = true;\nexport default polyfill(Element);"]},"metadata":{},"sourceType":"module"}